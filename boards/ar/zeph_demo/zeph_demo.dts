/dts-v1/;

#include <st/f1/stm32f103Xb.dtsi>
#include <st/f1/stm32f103r(8-b)tx-pinctrl.dtsi>


/ {
  model = "Demo board - really a Nucleo stm32f103rb";
  compatible = "ar,zeph_demo";

  chosen {
   		zephyr,console = &usart2;
		zephyr,shell-uart = &usart2;
    		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
    zephyr,display = &eink;
  };
 
  leds {
    compatible = "gpio-leds";
    green_led: led_child1 {
      gpios = <&gpioa 5 GPIO_ACTIVE_HIGH>;
      label = "Green LED on board";
    };
  };

  mipi_dbi {
    compatible = "zephyr,mipi-dbi-spi";
    spi-dev = <&spi1>;
    reset-gpios = <&gpiob 9 GPIO_ACTIVE_LOW>;
    dc-gpios = <&gpioc 8 GPIO_ACTIVE_HIGH>;
    write-only;
    #address-cells = <1>;
    #size-cells = <0>;
    eink: uc8719@0 {
      compatible = "ultrachip,uc8179";
      busy-gpios = <&gpiob 8 GPIO_ACTIVE_LOW>;
      duplex = <2048>; // half duplex.
      reg = <0x0>;
      mipi-max-frequency = <1000000>;
      mipi-mode = "MIPI_DBI_MODE_SPI_4WIRE";
      softstart = [27 27 2F 17];
			width = <800>;
			height = <480>;

      full {
				pwr = [17 17 3F 3F 11];
        vdcs = <0x24>;
        pll = <0x06>;
				//cdi = <0x10>;
				//t_c_o_n = <0x22>;

        lutc = [00 0F 0F 00 00 01 
                00 0F 01 0F 01 02 
                00 0F 0F 00 00 01 
                00 00 00 00 00 00 
                00 00 00 00 00 00 
                00 00 00 00 00 00 
                00 00 00 00 00 00];
        lutww = [10 0F 0F 00 00 01 
                  84 0F 01 0F 01 02 
                  20 0F 0F 00 00 01 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00];
        lutkw = [10  0F  0F  00  00  01  
                84  0F  01  0F  01  02  
                20  0F  0F  00  00  01  
                00  00  00  00  00  00  
                00  00  00  00  00  00  
                00  00  00  00  00  00  
                00  00  00  00  00  00];
        lutwk = [80 0F 0F 00 00 01 
                84 0F 01 0F 01 02 
                40 0F 0F 00 00 01 
                00 00 00 00 00 00 
                00 00 00 00 00 00 
                00 00 00 00 00 00 
                00 00 00 00 00 00];
        lutkk = [80 0F 0F 00 00 01 
                  84 0F 01 0F 01 02 
                  40 0F 0F 00 00 01 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00 
                  00 00 00 00 00 00];

			};

    };
  };

  aliases {
     led0 = &green_led;
  };

};

&spi1 {
	pinctrl-0 = <&spi1_sck_master_pa5 &spi1_miso_master_pa6 &spi1_mosi_master_pa7>;
	pinctrl-names = "default";
	cs-gpios = <&gpiob 6 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
	status = "okay";
};


// From the SoC include...

&clk_hsi {
	status = "okay";
};

&rcc {
  clocks = <&clk_hsi>;
  clock-frequency = <DT_FREQ_M(8)>;
  ahb-prescaler = <1>;
	apb1-prescaler = <1>;
	apb2-prescaler = <1>;
	adc-prescaler = <2>;
};

&usart2 {
  pinctrl-0 = <&usart2_tx_pa2 &usart2_rx_pa3>;
  pinctrl-names = "default";
  current-speed = <115200>;
  status="okay";
};

